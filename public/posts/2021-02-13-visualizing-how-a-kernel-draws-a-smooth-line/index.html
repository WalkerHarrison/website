<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://walker-harrison.com/img/site-feature-image.jpeg"/>

<meta name="twitter:title" content="Visualizing How a Kernel Draws a Smooth Line"/>
<meta name="twitter:description" content="blah."/>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.79.0" />

    
    
    

<title>Visualizing How a Kernel Draws a Smooth Line • Walker Harrison</title>


<meta property="og:title" content="Visualizing How a Kernel Draws a Smooth Line" />
<meta property="og:description" content="blah." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://walker-harrison.com/posts/2021-02-13-visualizing-how-a-kernel-draws-a-smooth-line/" />
<meta property="og:image" content="https://walker-harrison.com/img/site-feature-image.jpeg"/>
<meta property="article:published_time" content="2021-02-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-02-13T13:19:38-05:00" /><meta property="og:site_name" content="Title" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.daa5ea7c23f7b2c94a57632d93636cc1a22426d408cfe2f5993b64078c91fb2b.css" integrity="sha256-2qXqfCP3sslKV2Mtk2NswaIkJtQIz&#43;L1mTtkB4yR&#43;ys=">


<link rel="stylesheet" href="/scss/print.03403d6699c303fba50f9bbd95f2810b3b0d125e1d67b107e4aff69cec69a2d7.css" integrity="sha256-A0A9ZpnDA/ulD5u9lfKBCzsNEl4dZ7EH5K/2nOxpotc=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-186200850-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-186200850-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://walker-harrison.com/">
        
          Walker Harrison
        
        </a>
      </span>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle" checked>
      <label for="menuToggle">Walker Harrison</label>
      
        
        
        
        <div class="author-image">
          <img src="https://walker-harrison.com/img/headshot2020square.jpeg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/consulting/">
						<span>Consulting</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/walkwearscrocs" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://github.com/WalkerHarrison" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/walkwearscrocs" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/walker-harrison-11a36b6b" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	<a href="mailto:walkerharrison1000@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 - 2021 htr3n
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Visualizing How a Kernel Draws a Smooth Line</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 13, 2021
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    


<p>A few years ago, I <a href="https://towardsdatascience.com/how-does-a-computer-draw-a-smooth-line-a484176ac24e" target="_blank">wrote a script</a> that produced GIFs like the one below that visualize how a kernel smoother draws a line through a series of points:</p>
<p><img src="img/kernel.gif" /></p>
<p>It was a quick but fun project that actually helped me understand how local regression works, so I figured I’d port it over to my new site and walk through the logic.</p>
<p>It seems a little simple to state, but the point of any (two-dimensional) line is to map x-values to y-values. The challenge of drawing a smooth curve, as opposed to a straight line which could be achieved with ordinary least squares, is to let the line follow the points as it passes through their neighborhoods while ignoring data that is more distant.</p>
<p>The way that kernel regression achieves such “local” effects is by defining a function (typically denoted as <span class="math inline">\(K\)</span>) that attributes weights to all the existing points based on how close they are to a theoretical new point.</p>
<p>Let’s whip up some actual data to illustrate the concept. We’ll sample x uniformly from 0 to <span class="math inline">\(4\pi\)</span> (to get two full periods of a trigonometric function), and assign y-values from a sufficiently “wiggly” function along with some noise:</p>
<pre class="r"><code>library(tidyverse)
library(magick)
theme_set(theme_bw())
set.seed(0)

n &lt;- 100
x &lt;- runif(n, 0, 4*pi)
# our function is the product of three distinct transformations
y &lt;- sin(x)*x^2*exp(-x/2) + rnorm(n, sd = 0.3)
df &lt;- data.frame(x, y)

df %&gt;%
  ggplot(aes(x, y)) +
  geom_point()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>So how are we gonna trace a line through this data? Well for any point on this theoretical curve, the y-value will be a weighted mean of nearby points. The only ___ is to define a weighting scheme, which is where we turn to a Gaussian kernel. We take the density, which works well because this function peaks at a distance of 0 (i.e. at the x-value in question), but then quickly drops off to either side.</p>
<p>The function gk takes as input the original dataset and also a new X value and returns the weight that each of the former should have on the latter based on proximity.</p>
<pre class="r"><code>x_new &lt;- seq(min(x), max(x), length.out = 100)

y_smoothed &lt;- map_dbl(x_new, ~sum(dnorm(x, mean = .x) * y)/
                        sum(dnorm(x, mean = .x)))

df_smoothed &lt;- data.frame(x_new, y_smoothed)</code></pre>
<pre class="r"><code>df %&gt;%
  ggplot(aes(x, y)) +
  geom_point() +
  geom_line(aes(x_new, y_smoothed), data = df_smoothed)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>x_new &lt;- seq(min(x), max(x), length.out = 100)

y_smoothed &lt;- map_dbl(x_new, ~sum(dnorm(x, mean = .x, sd = 0.5) * y)/
                        sum(dnorm(x, mean = .x, sd = 0.5)))

df_smoothed &lt;- data.frame(x_new, y_smoothed)</code></pre>
<pre class="r"><code>df %&gt;%
  ggplot(aes(x, y)) +
  geom_point() +
  geom_line(aes(x_new, y_smoothed), data = df_smoothed)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>idx &lt;- 50

df %&gt;%
  ggplot(aes(x, y)) +
  geom_point(aes(size = dnorm(x, mean = x_new[idx], sd = 0.5),
                 col = dnorm(x, mean = x_new[idx], sd = 0.5))) +
  geom_line(aes(x_new, y_smoothed), data = df_smoothed %&gt;% filter(x_new &lt;= x_new[idx])) +
  geom_point(aes(x_new, y_smoothed), data = df_smoothed %&gt;% filter(x_new == x_new[idx]),
             size = 3, fill = &quot;white&quot;, col = &quot;black&quot;, shape = 21) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>for (idx in 1:length(x_new)){
  
  plt &lt;- df %&gt;%
    ggplot(aes(x, y)) +
    geom_point(aes(size = dnorm(x, mean = x_new[idx], sd = 0.5),
                   col = dnorm(x, mean = x_new[idx], sd = 0.5))) +
    geom_line(aes(x_new, y_smoothed), data = df_smoothed %&gt;% filter(x_new &lt;= x_new[idx])) +
    geom_point(aes(x_new, y_smoothed), data = df_smoothed %&gt;% filter(x_new == x_new[idx]),
               size = 3, fill = &quot;white&quot;, col = &quot;black&quot;, shape = 21) +
    theme(legend.position = &quot;none&quot;)
  
  ggsave(plt, width = 6, height = 4, filename = paste0(&quot;kernel_&quot;, idx, &quot;.png&quot;))
}</code></pre>
<pre class="r"><code>img_files &lt;- paste0(&quot;kernel_&quot;, 1:length(x_new), &quot;.png&quot;)
gif &lt;- img_files %&gt;% 
  map(image_read) %&gt;%
  image_join() %&gt;%
  image_animate(fps = 10)

image_write(image = gif,
            path = &quot;kernel.gif&quot;)</code></pre>
<center>
<img src="/img/kernel.gif"/>
</center>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2021-01-23-gradient-ascent-finding-uphill-routes-for-my-long-walks/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Gradient Ascent: Finding Uphill Routes for my Long Walks</span>
    </a>
    
    
</div>


  

  
    
         <style>

.commento-root .commento-submit-button {
    font-size: 10px;
}

.commento-root * {
    font-size: 10px;
}

.commento-root textarea::placeholder{font-size:10px !important;
  
}

</style>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js">
</script>
<noscript>Please enable JavaScript to load the comments.</noscript>
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-186200850-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>

<script src="//yihui.org/js/math-code.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/r.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/yaml.min.js"></script>
            
        
    <script type="text/javascript">
        
        hljs.configure({languages: ["r, yaml"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
